<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined">
  <style>
    .item_holder {
      position: relative;
    }

    .basic_item {
      border-radius: 50%;
      width: 100px;
      height: 40px;
      position: absolute;
      top: 0;
      left: 0;
      color: white;
      font-weight: bold;
      text-align: center;
    }

    body {
      text-align: center;
    }
  </style>
</head>

<body>
  <br>
  <button id="create_publishconfig" class="blue">Create PublishConfig</button>
  <br><br>
  <button id="create_publishlist" class="blue">Create PublishList</button>
  <br><br>
  <button id="create_assetranges" class="blue">Create Asset Ranges</button>
  <hr>
  <b>Templates</b>
  <br>
  <select style="width:90%;text-align:left;" size="4">
    <option selected>Complex Layout</option>
    <option>Simple Layout</option>
    <option>Product List</option>
  </select>
  <br>
  <label>Name <input id="sheetname"></label>
  <br>
  <button id="create_layout_btn" class="green">Create Sheet</button>

  <script>
    class PublishWeb {
      constructor() {
        this.create_publishconfig = document.getElementById('create_publishconfig');
        this.create_publishconfig.addEventListener('click', e => this.createSheet('PublishConfig', 'PublishConfig'));

        this.create_publishlist = document.getElementById('create_publishlist');
        this.create_publishlist.addEventListener('click', e => this.createSheet('PublishList', 'PublishList'));

        this.create_assetranges = document.getElementById('create_assetranges');
        this.create_assetranges.addEventListener('click', e => this.createSheet('AssetRanges', 'Asset Ranges'));

        this.sheetname = document.getElementById('sheetname');
        this.sheetname.addEventListener('click', e => this.createSheet());

        this.create_layout_btn = document.getElementById('create_layout_btn');
      }
      async createSheet(layoutName = null, sheetName = null) {
        this.create_layout_btn.innerHTML = '...';
        let genResponse = await fetch('https://www.handtop.com/addontemplates/template_' + layoutName + '.json', {
          method: "get"
        });
        let genResults = await genResponse.json();
        return new Promise((resolve, reject) => {
          google.script.run.withSuccessHandler((result) => {
            this.create_layout_btn.innerHTML = 'Create Sheet';
            if (result !== 'success')
              alert(result);
            resolve(result);
          }).createSheetFromTemplate(sheetName, genResults);
        });
      }
    }

    document.addEventListener('DOMContentLoaded', e => {
      let publish_web = new PublishWeb();
    });
  </script>
</body>

</html>
